{% extends "base.html" %}

{% block title %}AI Generate Test Case - AI Test Case Manager{% endblock %}
{% block nav_create %}active{% endblock %}

{% block content %}
<div class="view animate-fade-in">
    <div class="form-container">
        <div class="form-header">
            <h1 class="form-title">
                <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                </svg>
                Generate Test Case with AI
            </h1>
            <a href="/create" class="back-link">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="19" y1="12" x2="5" y2="12"></line>
                    <polyline points="12 19 5 12 12 5"></polyline>
                </svg>
                Back
            </a>
        </div>
        
        <div class="form-group">
            <label class="form-label">Prompt</label>
            <textarea class="form-textarea" id="ai-prompt" rows="4" placeholder="e.g., 'Create a test case for a user trying to reset their password with an expired token...'"></textarea>
        </div>
        
        <div class="rag-toggle">
            <div class="rag-toggle-label">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
                </svg>
                Enable RAG (Retrieval-Augmented Generation)
            </div>
            <label class="toggle-switch">
                <input type="checkbox" id="use-rag" checked>
                <span class="toggle-slider"></span>
            </label>
        </div>
        
        <div class="advanced-settings">
            <button type="button" class="advanced-toggle" onclick="toggleAdvanced()">
                <span>Advanced RAG Settings</span>
                <svg id="advanced-chevron" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="6 9 12 15 18 9"></polyline>
                </svg>
            </button>
            <div id="advanced-content" class="advanced-content">
                <div class="slider-group">
                    <div class="slider-header">
                        <label class="form-label">Similarity Threshold</label>
                        <span class="slider-value" id="threshold-value">0.70</span>
                    </div>
                    <input type="range" class="range-slider" id="rag-threshold" min="0" max="1" step="0.05" value="0.7" oninput="document.getElementById('threshold-value').textContent = parseFloat(this.value).toFixed(2)">
                </div>
                <div class="form-group">
                    <label class="form-label">Max RAG References</label>
                    <input type="number" class="form-input" id="max-references" min="1" max="10" value="3">
                </div>
            </div>
        </div>
        
        <div id="ai-preview"></div>
        <div id="ai-error" class="form-error" style="display: none;"></div>
        
        <div class="form-actions">
            <button type="button" class="btn btn-secondary" id="preview-btn" onclick="handleAIPreview()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                </svg>
                Preview
            </button>
            <button type="button" class="btn btn-success" id="generate-save-btn" onclick="handleAIGenerateAndSave()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                </svg>
                Generate and Save
            </button>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="/static/js/create-ai.js"></script>
{% endblock %}
